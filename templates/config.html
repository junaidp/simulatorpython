{% extends "base.html" %}

{% block content %}
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6">Simulator Configuration</h2>

        <form id="configForm" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- User Count -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Number of Users
                        <span class="text-gray-500">(30-60)</span>
                    </label>
                    <input type="number" id="userCount" min="30" max="60" required
                           class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    <p class="text-xs text-gray-500 mt-1">Fictional employees to simulate</p>
                </div>

                <!-- History Days -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Historical Days</label>
                    <select id="historyDays"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                        <option value="14">14 days</option>
                        <option value="30">30 days</option>
                        <option value="90">90 days</option>
                        <option value="180">180 days</option>
                    </select>
                </div>

                <!-- Working Hours -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Working Hours</label>
                    <input type="text" id="workingHours" placeholder="09:00-18:00"
                           class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    <p class="text-xs text-gray-500 mt-1">Format: HH:MM-HH:MM</p>
                </div>

                <!-- Speed Multiplier -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Speed Multiplier
                        <span class="text-gray-500">(0.5-10)</span>
                    </label>
                    <input type="number" id="speedMultiplier" min="0.5" max="10" step="0.5"
                           class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                </div>

                <!-- Active Platforms -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Active Platforms</label>
                    <div class="flex gap-6">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="platformSlack" value="slack" class="w-4 h-4 text-blue-600">
                            <span class="text-sm">Slack</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="platformTeams" value="teams" class="w-4 h-4 text-blue-600">
                            <span class="text-sm">Microsoft Teams</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="platformJira" value="jira" class="w-4 h-4 text-blue-600">
                            <span class="text-sm">Jira</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="flex gap-4 pt-4">
                <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-2 rounded-lg transition">
                    <i class="fas fa-save mr-2"></i>Save Configuration
                </button>
                <button type="button" onclick="resetConfig()"
                        class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-8 py-2 rounded-lg transition">
                    <i class="fas fa-undo mr-2"></i>Reset to Defaults
                </button>
                <button type="button" onclick="loadConfig()"
                        class="bg-green-600 hover:bg-green-700 text-white px-8 py-2 rounded-lg transition">
                    <i class="fas fa-sync-alt mr-2"></i>Reload
                </button>
            </div>
        </form>
    </div>

    <script>
        async function loadConfig() {
            try {
                const config = await apiCall('/api/config');

                document.getElementById('userCount').value = config.user_count || 45;
                document.getElementById('historyDays').value = config.history_days || 180;
                document.getElementById('workingHours').value = config.working_hours || '09:00-18:00';
                document.getElementById('speedMultiplier').value = config.speed_multiplier || 1;

                const platforms = config.platforms || ['slack', 'teams', 'jira'];
                document.getElementById('platformSlack').checked = platforms.includes('slack');
                document.getElementById('platformTeams').checked = platforms.includes('teams');
                document.getElementById('platformJira').checked = platforms.includes('jira');

                showNotification('Configuration loaded', 'success');
            } catch (error) {
                showNotification('Failed to load configuration', 'error');
            }
        }

        document.getElementById('configForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const platforms = [];
            if (document.getElementById('platformSlack').checked) platforms.push('slack');
            if (document.getElementById('platformTeams').checked) platforms.push('teams');
            if (document.getElementById('platformJira').checked) platforms.push('jira');

            const config = {
                user_count: parseInt(document.getElementById('userCount').value),
                history_days: parseInt(document.getElementById('historyDays').value),
                working_hours: document.getElementById('workingHours').value,
                speed_multiplier: parseFloat(document.getElementById('speedMultiplier').value),
                platforms: platforms
            };

            try {
                const result = await apiCall('/api/config', 'POST', config);
                if (result.success) {
                    showNotification('Configuration saved successfully!', 'success');
                }
            } catch (error) {
                showNotification('Failed to save configuration', 'error');
            }
        });

        function resetConfig() {
            if (confirm('Reset configuration to defaults?')) {
                document.getElementById('userCount').value = 45;
                document.getElementById('historyDays').value = 180;
                document.getElementById('workingHours').value = '09:00-18:00';
                document.getElementById('speedMultiplier').value = 1;
                document.getElementById('platformSlack').checked = true;
                document.getElementById('platformTeams').checked = true;
                document.getElementById('platformJira').checked = true;
            }
        }

        // Load config on page load
        loadConfig();
    </script>
{% endblock %}